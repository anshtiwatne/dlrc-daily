<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
</head>

<body>
    <img src="https://firebasestorage.googleapis.com/v0/b/dlrc-daily.appspot.com/o/coverImages%2F1691487962769?alt=media&token=04b6fc98-08ad-49c9-8200-38fc96211605"
        crossorigin="anonymous">
</body>

<script>
    const colorThief = new ColorThief()

    function toHSL(r, g, b) {
        r /= 255, g /= 255, b /= 255

        var max = Math.max(r, g, b), min = Math.min(r, g, b)
        var h, s, l = (max + min) / 2

        if (max == min) {
            h = s = 0
        }
        else {
            var d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min)

            switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break
                case g: h = (b - r) / d + 2; break
                case b: h = (r - g) / d + 4; break
            }

            h /= 6;
        }

        h = Math.round(360 * h)
        s = Math.round(100 * s)
        l = Math.round(100 * l)

        return { h: h, s: s, l: l };
    }

    function getBgColor(imageEl) {

        let canvas = document.createElement('canvas'),

            context = canvas.getContext && canvas.getContext('2d'),
            imgData, width, height, length,
            rgb = { r: 0, g: 0, b: 0 },
            count = 0

        height = canvas.height = imageEl.naturalHeight || imageEl.offsetHeight || imageEl.height
        width = canvas.width = imageEl.naturalWidth || imageEl.offsetWidth || imageEl.width

        context.drawImage(imageEl, 0, 0)
        imgData = context.getImageData(0, 0, width, height)
        length = imgData.data.length;

        for (let i = 0; i < length; i += 4) {
            rgb.r += imgData.data[i]
            rgb.g += imgData.data[i + 1]
            rgb.b += imgData.data[i + 2]
            count++;
        }

        rgb.r = Math.floor(rgb.r / count)
        rgb.g = Math.floor(rgb.g / count)
        rgb.b = Math.floor(rgb.b / count)
        console.log(rgb.r, rgb.g, rgb.b)
        let hsl = toHSL(rgb.r, rgb.g, rgb.b)
        // increase luminosity and saturation if too dark
        if (hsl.l < 75) {
            hsl.s = Math.round((hsl.l / 75 + 1) * 25)
            hsl.l = 75
        }

        const bgColor = `hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)`
        
        return bgColor
    }

    const image = document.querySelector('img')
    image.onload = () => {
        const color = getBgColor(image)
        console.log(color)
        document.body.style.backgroundColor = color
    }
</script>